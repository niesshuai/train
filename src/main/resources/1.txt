select begindata.cmaterialoid,begindata.cmaterialvid,begindata.pk_group,begindata.pk_org,bd_materialstock.pk_marpuclass, sum(COALESCE(begindata.nnum, 0#)) nbeginnum, sum(COALESCE(begindata.nassistnum, 1#)) nbeginastnum, sum(COALESCE(begindata.ngrossnum, 2#)) nbegingrossnum, 3# nterminnum, 4# nterminastnum, 5# ntermingorsstnum, 6# ntermoutnum, 7# ntermoutastnum, 8# ntermoutgorsstnum, sum(COALESCE(begindata.nnum, 9#)) nonhandnum, sum(COALESCE(begindata.nassistnum, 10#)) nonhandastnum, sum(COALESCE(begindata.ngrossnum, 11#)) ngrossnum from (select inithand.pk_group pk_group,inithand.pk_org pk_org,inithand.cmaterialvid cmaterialvid,inithand.cmaterialoid cmaterialoid,sum(COALESCE(inithand.nnum,12#) )  nnum,sum(COALESCE(inithand.nassistnum,13#) )  nassistnum,sum(COALESCE(inithand.ngrossnum,14#) )  ngrossnum from ( select hand.pk_group pk_group,hand.pk_org pk_org,hand.cmaterialvid cmaterialvid,hand.cmaterialoid cmaterialoid,hand.nnum nnum,hand.nassistnum nassistnum,hand.ngrossnum ngrossnum from ic_month_hand hand where 15#=16#  and  hand.dr=17# and hand.pk_group='18$'  and  hand.dyearmonth='19$'   and (hand.pk_org = '20$')  and (hand.pk_group = '21$')  and (hand.pk_group = '22$') union all  select record.pk_group pk_group,record.pk_org pk_org,record.cmaterialvid cmaterialvid,record.cmaterialoid cmaterialoid,COALESCE(record.ninnum,23#)-COALESCE(record.noutnum,24#) nnum,COALESCE(record.ninassistnum,25#)-COALESCE(record.noutassistnum,26#) nassistnum,COALESCE(record.ningrossnum,27#)-COALESCE(record.noutgrossnum,28#) ngrossnum from ic_month_record record inner join ic_transtype transtype on(record.ctrantypeid=transtype.ctrantypeid)  where 29#=30#  and  record.dr=31# and record.pk_group='32$'  and  record.dyearmonth>='33$'  and  record.dyearmonth<='34$'  and transtype.baffectonhand='35$' and  (COALESCE(record.ninnum,36#)-COALESCE(record.noutnum,37#)<>38# or COALESCE(record.ninassistnum,39#)-COALESCE(record.noutassistnum,40#)<>41# or COALESCE(record.ningrossnum,42#)-COALESCE(record.noutgrossnum,43#)<>44#)   and (record.pk_org = '45$')  and (record.pk_group = '46$')  and (record.pk_group = '47$') union all  select flowallview.pk_group pk_group,flowallview.pk_org pk_org,flowallview.cmaterialvid cmaterialvid,flowallview.cmaterialoid cmaterialoid,COALESCE(flowallview.ninnum,48#)-COALESCE(flowallview.noutnum,49#) nnum,COALESCE(flowallview.ninassistnum,50#)-COALESCE(flowallview.noutassistnum,51#) nassistnum,COALESCE(flowallview.ningrossnum,52#)-COALESCE(flowallview.noutgrossnum,53#) ngrossnum from ( select flow.pk_group pk_group,flow.pk_org pk_org,flow.cmaterialvid cmaterialvid,flow.cmaterialoid cmaterialoid,flow.ninnum ninnum,flow.ninassistnum ninassistnum,flow.ningrossnum ningrossnum,flow.noutnum noutnum,flow.noutassistnum noutassistnum,flow.noutgrossnum noutgrossnum from ic_flow flow inner join ic_transtype transtype on(flow.ctrantypeid=transtype.ctrantypeid and transtype.baffectonhand='54$' )  where 55#=56#  and flow.dr=57# and flow.dbizdate>='58$' and flow.dbizdate<='59$' and flow.pk_group='60$'  and (flow.pk_org = '61$')  and (flow.pk_group = '62$')  and (flow.pk_group = '63$') union all  select flow.pk_group pk_group,flow.pk_org pk_org,flow.cmaterialvid cmaterialvid,flow.cmaterialoid cmaterialoid,flow.ninnum ninnum,flow.ninassistnum ninassistnum,flow.ningrossnum ningrossnum,flow.noutnum noutnum,flow.noutassistnum noutassistnum,flow.noutgrossnum noutgrossnum from ic_flowaccount_his flow inner join ic_transtype transtype on(flow.ctrantypeid=transtype.ctrantypeid and transtype.baffectonhand='64$' )  where 65#=66#  and flow.dr=67# and flow.dbizdate>='68$' and flow.dbizdate<='69$' and flow.pk_group='70$'  and (flow.pk_org = '71$')  and (flow.pk_group = '72$')  and (flow.pk_group = '73$')) flowallview ) inithand inner join bd_material_v bd_material_v on (inithand.cmaterialoid = bd_material_v.pk_source)  inner join bd_materialstock bd_materialstock on (inithand.pk_org = bd_materialstock.pk_org AND bd_material_v.pk_material = bd_materialstock.pk_material)  group by inithand.pk_group,inithand.pk_org,inithand.cmaterialvid,inithand.cmaterialoid) begindata inner join bd_materialstock bd_materialstock on (begindata.cmaterialvid = bd_materialstock.pk_material AND begindata.pk_org = bd_materialstock.pk_org)  group by begindata.cmaterialoid,begindata.cmaterialvid,begindata.pk_group,begindata.pk_org,bd_materialstock.pk_marpuclass